<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <PropertyGroup>
    <MSBuildAllProjects>$(MSBuildAllProjects);$(MSBuildThisFileFullPath)</MSBuildAllProjects>
  </PropertyGroup>

  <PropertyGroup>
    <_SdkPlatformName>$(TargetFrameworkIdentifier)</_SdkPlatformName>
    <_SdkPlatformName Condition="'$(TargetFrameworkIdentifier)' == '.NETCore' OR '$(TargetFrameworkIdentifier)' == 'WindowsPhoneApp'">Windows</_SdkPlatformName>
    <_SdkPlatformName Condition="'$(TargetFrameworkIdentifier)' == '.NETPortable'">Portable</_SdkPlatformName>
    <_SdkPlatformName Condition="'$(TargetFrameworkIdentifier)' == '.NETFramework'">Desktop</_SdkPlatformName>
    <_SdkPlatformName Condition="$(TargetFrameworkIdentifier.StartsWith('Xamarin'))">Xamarin</_SdkPlatformName>
    <_SdkPlatformName Condition="'$(TargetFrameworkIdentifier)' == 'MonoAndroid' OR '$(TargetFrameworkIdentifier)' == 'MonoTouch' OR '$(TargetFrameworkIdentifier)' == 'MonoMac'">Xamarin</_SdkPlatformName>
  </PropertyGroup>

  <PropertyGroup Condition="'$(LanguageTargets)' == '' and '$(LanguageTargets)' != 'Desktop' ">
    <LanguageTargets>$(MSBuildThisFileDirectory)LanguageTargets\$(_SdkPlatformName).targets</LanguageTargets>
    <LanguageTargets Condition="!Exists('$(LanguageTargets)')"/>
  </PropertyGroup>

  <!-- If the target doesn't exist, don't use it, means we've been called from dotnet 
       This can happen if one of the targets is used by a test project called by dotnet test no-build.
       Note that the scenario does not cover WPF by dotnet test.
  -->
  <PropertyGroup Condition="'$(LanguageTargets)' == '' and '$(LanguageTargets)' == 'Desktop' and '$(OS)' == 'Windows_NT' and '$(MSBuildRuntimeType)' == 'Full'  ">
    <!-- Workaround for lack of XAML support in the new project system -->
    <LanguageTargets Condition="'$(_SdkLanguageSourceName)' != 'FSharp'" >$(MSBuildExtensionsPath)\$(VisualStudioVersion)\Bin\Microsoft.$(_SdkLanguageSourceName).targets</LanguageTargets>
    <LanguageTargets Condition="'$(_SdkLanguageSourceName)' == 'FSharp'" >$(MSBuildExtensionsPath)\Microsoft\VisualStudio\v$(VisualStudioVersion)\FSharp\Microsoft.FSharp.Targets</LanguageTargets>
  </PropertyGroup>
  <!-- Add conditional compilation symbols for the target framework and one with version -->
  <PropertyGroup Condition="'$(DisableImplicitFrameworkDefines)' != 'true'">
    <ImplicitFrameworkIdentifierDefine>$(TargetFrameworkIdentifier.TrimStart('.').Replace('.','_').ToUpperInvariant())</ImplicitFrameworkIdentifierDefine>
    <ImplicitFrameworkDefine>$(TargetFramework.Replace('.','_').Replace('-','_').ToUpperInvariant())</ImplicitFrameworkDefine>
  </PropertyGroup>

  <PropertyGroup Condition="'$(PlatformTargets)' == ''">
    <PlatformTargets>$(MSBuildThisFileDirectory)Platforms\$(_SdkPlatformName).targets</PlatformTargets>
  </PropertyGroup>

  <Import Project="$(PlatformTargets)" Condition="Exists('$(PlatformTargets)')"/>

  <PropertyGroup Condition="'$(DisableImplicitFrameworkDefines)' != 'true' AND '$(_SdkLanguageSourceName)' != 'VisualBasic'">
    <DefineConstants Condition="'$(DefineConstants)' != '' AND !$(DefineConstants.EndsWith(';'))">$(DefineConstants);</DefineConstants>
    <DefineConstants>$(DefineConstants)$(_SdkImplicitFrameworkProfileDefine)</DefineConstants>
  </PropertyGroup>

  <PropertyGroup Condition="'$(DisableImplicitFrameworkDefines)' != 'true' AND '$(_SdkLanguageSourceName)' == 'VisualBasic'">
    <FinalDefineConstants Condition="'$(FinalDefineConstants)' != '' AND !$(DefineConstants.EndsWith(','))">$(FinalDefineConstants),</FinalDefineConstants>
    <FinalDefineConstants Condition="'$(_SdkImplicitFrameworkProfileDefine)' != ''">$(FinalDefineConstants)$(_SdkImplicitFrameworkProfileDefine)=-1</FinalDefineConstants>
  </PropertyGroup>

  <!-- The conditional compilation symbols defined in the above import and the property-group flows to the Main SDK -->
  <PropertyGroup Condition="'$(DisableImplicitFrameworkDefines)' != 'true'">
    <DisableImplicitFrameworkDefines>true</DisableImplicitFrameworkDefines>
    <VersionlessImplicitFrameworkDefine>$(ImplicitFrameworkIdentifierDefine)</VersionlessImplicitFrameworkDefine>
  </PropertyGroup>

  <ItemGroup Condition="'$(DisableImplicitFrameworkReferences)' != 'true'">
    <!-- Set Pack=false on implicit references so they don't get added to NuGet packages as framework assemblies -->
    <_SdkImplicitReference Update="@(_SdkImplicitReference)" Pack="false"/>

    <!--
      Don't duplicate any references that are explicit in the project file.
      This means that if you do want to include a framework assembly in your NuGet package,
      you can just add the Reference to your project file.
    -->
    <_SdkImplicitReference Remove="@(Reference)"/>

    <!-- Add the implicit references to @(Reference) -->
    <Reference Include="@(_SdkImplicitReference)"/>
  </ItemGroup>

</Project>